---
layout: PostSimple
title: 'Claude Code Hooks：代理式程式開發的觀測性與控制力'
summary: '深入探討 Claude Code Hooks 如何革新代理式程式開發，透過五種核心 hook 機制提供前所未有的觀測性與控制力，讓工程師能更安全有效地運用 AI 代理進行程式開發。'
date: '2025-07-29'
lastmod: '2025-07-29'
tags: ['Claude Code', 'AI Coding', 'Hooks', 'Agent', 'AI']
draft: false
images: ['https://image.cashwu.com/2025/claude-code-hooks-advanced-agentic-coding/cover.webp']
---

![](https://image.cashwu.com/2025/claude-code-hooks-advanced-agentic-coding/cover.webp)

在代理式程式開發的世界中，我們時常面臨一個有趣的悖論：當 AI 代理（Agent）越來越「智慧」時，它們偶爾會做出讓人啼笑皆非的決定。想像一個場景：代理為了「優化」你的程式碼庫，決定執行 `rm -rf` 命令來「清理」不必要的檔案。幸運的是，在 Claude Code Hooks 的世界裡，這樣的災難可以被有效阻止。

## Claude Code Hooks：代理式開發的安全防護網

Claude Code hook（Hooks）不僅僅是一個監控工具，它更像是代理式程式開發的「保險絲」。透過在代理生命週期的關鍵節點插入 hook，我們能夠實現前所未有的**觀測性（Observability）**和**控制力（Control）**。

### 五種核心 hook 機制

#### 1. 工具使用前 hook（PreToolUse Hook）

這是整個安全防護體系的第一道防線。每當代理準備執行任何工具操作時，這個 hook 會率先觸發，讓我們能在最後關頭進行審查和阻止。

**核心功能：**

- 阻擋危險命令（如 `rm -rf`、`sudo` 等）
- 限制對敏感檔案的訪問（如 `.env`、配置檔案）
- 實作自訂的安全策略

影片中最令人印象深刻的演示，就是當代理嘗試執行危險的刪除命令時，系統立即發出「命令已被阻擋」的語音通知，並阻止了潛在的災難。

#### 2. 工具使用後 hook（PostToolUse Hook）

如果說 pre-tool-use 是防護，那麼 post-tool-use 就是記錄員。它在每個工具執行完畢後觸發，為我們提供詳細的操作日誌。

**應用場景：**

- 記錄所有工具使用情況
- 分析代理的行為模式
- 建立詳細的審計追蹤

#### 3. 通知 hook（Notification Hook）

當代理需要人類介入時，通知 hook 扮演著橋樑的角色，提供即時的自然語言通知。

**典型情境：**

- 代理需要額外權限
- 遇到不確定的決策點
- 需要使用者確認敏感操作

#### 4. 停止 hook（Stop Hook）

每當 Claude Code 完成一輪回應時，停止 hook 就會啟動，標示任務的完成並進行必要的清理工作。

**主要功能：**

- 自動匯出聊天記錄
- 產生任務完成報告
- 觸發後續的自動化流程

#### 5. 子代理停止 hook（Subagent Stop Hook）

在複雜的多代理協作場景中，子代理停止 hook 確保每個並行任務的完成狀態都能被及時追蹤。

**應用價值：**

- 多任務並行處理的狀態管理
- 長時間運行任務的進度追蹤
- 複雜工作流程的協調

> 官方文件 [開始使用 Claude Code hooks](https://docs.anthropic.com/zh-TW/docs/claude-code/hooks-guide)

## 技術實作：Python 整合的無限可能

影片中最讓我震撼的部分，是 hook 與 Python 程式碼的深度整合。所有 hook 都配置在 `.cloud` 目錄下的 `settings.json` 檔案中

> 相關的程式碼內容，請參考 [Github Repo - settings.json](https://github.com/disler/claude-code-hooks-mastery/blob/main/.claude/settings.json)

### 跨平台語音通知實作

影片特別強調使用 UV 工具，以隔離的單檔 Python 腳本形式來執行 hook。更令人驚嘆的是語音通知功能的實現

> 相關的程式碼內容，請參考 [Github Repo - elevenlabs_tts.py](https://github.com/disler/claude-code-hooks-mastery/blob/main/.claude/hooks/utils/tts/elevenlabs_tts.py)

## 代理式程式開發的三大核心要素

影片深入闡述了代理式程式開發的核心框架：**上下文（Context）、模型（Model）、提示（Prompt）**。Claude Code hook 在這個框架中扮演著關鍵角色：

### 上下文管理

透過 hook 的日誌記錄和狀態追蹤，我們能夠：

- 維護完整的操作歷史
- 理解代理的決策脈絡
- 建立持續學習的基礎

### 模型優化

hook 提供的觀測性數據，幫助我們：

- 分析模型的行為模式
- 識別需要改進的領域
- 調整提示工程策略

### 提示工程

控制機制使我們能夠：

- 即時調整代理行為
- 實施安全防護措施
- 實現更精確的任務執行

## Claude Code：新型工程基元的誕生

Claude Code 不僅僅是一個開發工具，它代表了一個全新的「**工程基元（Engineering Primitive）**」概念。這個基元具備三個關鍵特性：

### 1. 自訂斜線指令

允許開發者創建專屬的命令集，實現高度客製化的工作流程。

### 2. hook 機制

將確定性行為注入代理的生命週期，實現精確控制。

### 3. 可程式化互動

作為第一個支援程式化互動的代理式程式碼工具，Claude Code 可以像程式碼模組一樣被整合和調用，例如透過 `cld -p hello` 這樣的命令。

這些特性共同實現了「**偉大規劃即是偉大提示**」的核心理念，讓工程師能夠：

- 提升運算優勢
- 擴展工作範圍
- 優化提示策略
- 建立可重用的規格

## 快速開始指南

### 基本設定

1. 在專案根目錄建立 `.cloud/hooks/` 目錄
2. 建立 `settings.json` 配置檔案
3. 撰寫第一個 Python hook 腳本

### 常用 hook 範例

- **安全檢查 hook**：阻擋危險命令執行
- **日誌記錄 hook**：詳細記錄所有操作
- **通知提醒 hook**：重要事件的即時通知

### 學習資源

想要深入學習 Claude Code Hooks 的實作細節，可以參考這個優秀的 GitHub repository：
[claude-code-hooks-mastery](https://github.com/disler/claude-code-hooks-mastery)

這個 repo 包含了豐富的範例程式碼和最佳實踐，是入門和進階學習的絕佳資源。

## 個人感想與未來展望

觀看這部影片後，我深深體會到自己對 Claude Code hook 的理解還相當膚淺。影片中展示的進階應用——Python 腳本的無縫整合、智慧的語音通知系統、複雜的多代理協作機制——這些都遠遠超出了我之前的使用範圍。

特別是看到講者如何運用 Python 腳本實現各種精妙的控制邏輯，如何透過語音回饋建立真正的人機對話介面，以及如何在複雜的開發流程中維持完美的可觀測性，我不禁感嘆：**看過這部影片後，都不能說自己會 hook 了！**

這種程度的技術整合和創新思維，讓我重新認識了 Claude Code 的潛力。它不僅是一個 AI 程式設計助手，更是一個可以徹底改變軟體開發模式的平台。

對於想要深入學習 Claude Code hook 的開發者，我建議：

1. **從基礎開始**：先掌握五種基本 hook 的使用方法
2. **實驗 Python 整合**：嘗試建立自己的 hook 腳本
3. **關注安全性**：始終將安全防護作為首要考量
4. **建立最佳實踐**：逐步建立適合自己團隊的 hook 規範
5. **持續學習**：關注社群中的進階用法和創新案例

## 結語

Claude Code 顯著提升了工程師的開發效率，是 2025 年最重要的開發工具之一

透過 Claude Code hook，我們不僅獲得了強大的 AI 協作夥伴，更重要的是保持了對開發過程的完全掌控。這種平衡——既要擁抱 AI 的效率，又要維持人類的監督——正是未來軟體開發的關鍵所在。

雖然工具會不斷進化，但掌握「上下文、模型、提示」這三大核心原則，將是我們在瞬息萬變的生成式 AI 時代保持競爭力的根本。

<iframe
  style={{
    width: '100%',
    aspectRatio: '16 / 9',
  }}
  src="https://www.youtube.com/embed/J5B9UGTuNoM?si=_c7MeSs31BkMYljJ"
  title="I'm HOOKED on Claude Code Hooks: Advanced Agentic Coding"
  frameborder="0"
  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
  referrerpolicy="strict-origin-when-cross-origin"
  allowfullscreen
></iframe>

---

## 支持創作

如果這篇文章對您有幫助，歡迎透過 [贊助連結](https://portaly.cc/cashwugeek/support) 支持我持續創作優質內容。您的支持是我前進的動力！
